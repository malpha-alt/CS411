<!DOCTYPE html>
<html>
    <style>
        .top-left {
            position: absolute;
            top: 10px;
            left: 10px;
        }
        .top-middle {
            position: absolute;
            top: 50px;
            left: 10px 
        }
        .top-right {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .search-results {
            position: absolute;
            top: 100px;
            left: 10px 
        }
    </style>
    <body>
        <a href="/" class="top-left">
            <button>Go to map page</button>
        </a>

        <form id="form" method="POST" class="top-middle">
            {{ form.csrf_token }}
            <input type="search" id="query" name="query" placeholder="Artist...">
            {{ form.date }}
            <button type="submit">Search</button>
        </form>
        
        {% if results is none %}
            <script>
            function showAlert() {
                event.preventDefault();  // This will prevent the default action
                alert('No results found');
            }
            window.onload = function() {
                showAlert();
            }
            </script>
        {% else %}
            <div class="search-results">
                {% for result in results %}
                <a href="#" onclick="addConcert('{{ result.artist }}', '{{ result.date }}', '{{ result.venue }}', '{{ result.city }}', '{{ result.lat }}', '{{ result.lng }}')">
                    {{ result.artist }} {{ result.date }} {{ result.venue }} {{ result.city }}
                </a> <! --Displays all the search results as clickable items -->
                <hr>
                {% endfor %}
            </div>
        {% endif %}

        <div id="artistList" class="added-results"></div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            function addConcert(artist, date, venue, city, lat, lng) { // Adds a concert to a server side variable
                alert('Added ' + artist + ' to your list of concerts!');

                selectedResult = [{artist, date, venue, city, lat, lng}];
                $.ajax({
                    url: '/storedata',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(selectedResult),
                    success: function() {
                        console.log("Data stored successfully");
                    },
                    error: function(response){
                        console.log("Error:", response.responseText);
                        alert('Failed to add concert!');
                    }
                });
            }

        </script>
    </body>
</html>

